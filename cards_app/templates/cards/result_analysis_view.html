{% extends "base_ok.html" %}
{% load static %}
{% block css %}
<link href="{% static 'cards/custom_card.css' %}" rel="stylesheet">
<style>
  /* Таблиця завжди прокручується горизонтально */
  .table-responsive-custom {
    display: block;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch; /* інерційна прокрутка на iOS */
  }

  /* Опційно: щоб таблиця не "зжималась" на маленьких екранах */
  .table-responsive-custom table {
    min-width: 700px;
  }
</style>
{% endblock css %}

{% block dynamic_content %}
<div class="container mt-4">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-header bg-primary text-white rounded-top-4">
      <h4 class="mb-0">
        <i class="bi bi-clipboard2-pulse me-2"></i>Результати аналізу
      </h4>
    </div>

    <div class="card-body">
      <!-- Інформація про аналіз -->
      <div class="row mb-4">
        <div class="col-md-4">
          <p class="mb-1 font-weight-bold">Номер медичної картки:</p>
          <p class="fs-5">{{ card.display_id }}</p>
        </div>
        <div class="col-md-4">
          <p class="mb-1 font-weight-bold">ID направлення:</p>
          <p class="fs-5">{{ card_analysis.referral.display_id }}</p>
        </div>
        <div class="col-md-4">
          <p class="mb-1 font-weight-bold">ID лаборанта:</p>
          <p class="fs-5">{{ card_analysis.lab_assistent.tab_nomer }}</p>
        </div>
      </div>

      <!-- Таблиця результатів параметрів -->
      <div class="table-responsive-custom">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr class="font-weight-bold text-center">
              <th>Назва параметра</th>
              <th>MIN</th>
              <th>MAX</th>
              <th>Результат</th>
              <th>О/В</th>
              <th>Коментар</th>
            </tr>
          </thead>
          <tbody>
            {% for param in card_analysis.resultparameter_set.all %}
            <tr>
              <td>{{ param.template.name }}</td>
              <td>{{ param.template.normal_min }}</td>
              <td>{{ param.template.normal_max }}</td>
              {% if param.value < param.template.normal_min or param.value > param.template.normal_max %}
                <td class="text-danger fw-bold">{{ param.value }}</td>
              {% else %}
                <td>{{ param.value }}</td>
              {% endif %}
              <td>{{ param.unit_of_measurement|default:"-" }}</td>
              <td>{{ param.coment|default:"—" }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center text-muted py-3">
                Немає результатів параметрів
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Висновок -->
      <div class="mt-4">
        <h5 class="font-weight-bold mb-2"><i class="bi bi-journal-text me-1"></i>Висновок</h5>
        <p class="mb-1">{{ card_analysis.report|linebreaksbr }}</p>
      </div>
    </div>

    {% comment %} <div class="card-footer bg-white text-end">
      <a href={% url "card:result_analysis_profile" %} class="btn btn-outline-secondary rounded-pill">
        <i class="bi bi-arrow-left"></i> Назад до списку</a>
    </div> {% endcomment %}
<div class="card-footer bg-white text-end">
    {% comment %} {% if "ПАЦІЄНТИ" in user_groups %}
        <a href="{% url 'card:result_analysis_profile' %}" 
           class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-arrow-left"></i> Назад до списку
        </a>
    {% elif "ЛАБОРАНТИ" in user_groups %}
            <a href="{% url 'card:journal_referral' %}" 
           class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-arrow-left"></i> Назад до списку
        </a>
    {% else %}
        <a href="{% url 'card:result_analysis' card.display_id %}" 
           class="btn btn-outline-secondary rounded-pill">
            <i class="bi bi-arrow-left"></i> Назад до списку
        </a>
    {% endif %} {% endcomment %}
    <a href="javascript:history.back()" 
   class="btn btn-outline-secondary rounded-pill">
    <i class="bi bi-arrow-left"></i> Назад
</a>
</div>







  </div>
</div>
{% endblock %}